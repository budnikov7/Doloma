---
name: ssl-ext-commands 
description: Документация по подсистеме "Подключаемые команды" библиотеки стандартных подсистем (БСП). Подключай, когда нужно в новом документе реализовать возможность подключения дополнительных команд (печать, отчеты, ввод на основании) или реализовать новую подключаемую команду к существующему документу.
---

# Подключаемые команды (Библиотека стандартных подсистем 3.1.3)

> **Краткое описание (RAG Summary)**  
> Подсистема «Подключаемые команды» в Библиотеке стандартных подсистем (БСП) 1С предназначена для программного вывода команд в формах, списках и журналах конфигурации. К таким командам относятся:
> - Команды **создания на основании**;
> - Команды **заполнения** объектов (документов/справочников);
> - Команды **печати**;
> - Команды **отчётов** (в частности, варианты отчётов).  
>
> Также возможно **расширять** типы подключаемых команд и **подключать** их к любой форме (включая формы из расширений).  
> В данном документе описаны типовые задачи разработки и настройки этих команд.

----

## 1. Настройка (общая)

### 1.1. Типовая задача: «Подключить формы объектов, чтобы в них отображалось подменю «Печать», «Отчёты» или «Заполнить»»

**Краткое описание**  
Чтобы команды (например, печати, дополнительных отчётов, заполнения и т.д.) выводились в формах объектов или списков, необходимо в модуле формы прописать специальные вызовы из подсистемы «Подключаемые команды». При этом задействуются:
- Обработчики событий формы: `ПриСозданииНаСервере`, `ПриЧтенииНаСервере`, `ПриОткрытии`.
- Процедуры-обработчики команд: `Подключаемый_ВыполнитьКоманду`, `Подключаемый_ПродолжитьВыполнениеКомандыНаСервере`, `ВыполнитьКомандуНаСервере`, `Подключаемый_ОбновитьКоманды`.

Ниже пример минимального фрагмента кода в модуле формы.

```bsl
// ------------------------------------
// СтандартныеПодсистемы.ПодключаемыеКоманды
// При создании формы на сервере
&НаСервере
Процедура ПриСозданииНаСервере(ЭтотОбъект)
    ПодключаемыеКоманды.ПриСозданииНаСервере(ЭтотОбъект);
КонецПроцедуры

// Обработчик команды (клиент)
&НаКлиенте
Процедура Подключаемый_ВыполнитьКоманду(Команда)
    ПодключаемыеКомандыКлиент.НачатьВыполнениеКоманды(
        ЭтотОбъект, Команда, <ОбъектИлиТаблицаФормы>
    );
КонецПроцедуры

// Продолжение выполнения на сервере
&НаКлиенте
Процедура Подключаемый_ПродолжитьВыполнениеКомандыНаСервере(
    ПараметрыВыполнения, ДополнительныеПараметры) Экспорт

    ВыполнитьКомандуНаСервере(ПараметрыВыполнения);
КонецПроцедуры

// Само выполнение команды на сервере
&НаСервере
Процедура ВыполнитьКомандуНаСервере(ПараметрыВыполнения)
    ПодключаемыеКоманды.ВыполнитьКоманду(
        ЭтотОбъект, ПараметрыВыполнения, <ОбъектИлиТаблицаФормы>
    );
КонецПроцедуры

// Обновление команд в интерфейсе (клиент)
&НаКлиенте
Процедура Подключаемый_ОбновитьКоманды()
    ПодключаемыеКомандыКлиентСервер.ОбновитьКоманды(
        ЭтотОбъект, <ОбъектИлиТаблицаФормы>
    );
КонецПроцедуры
// Конец СтандартныеПодсистемы.ПодключаемыеКоманды
```

> **Примечание по параметру `<ОбъектИлиТаблицаФормы>`**  
> - Для **формы объекта** передаётся реквизит формы типа `ДанныеФормыСтруктура` (обычно `Объект`).
> - Для **формы списка** передаётся элемент формы (ТаблицаФормы) с динамическим списком.

Дополнительно:
- В обработчик `ПриЧтенииНаСервере(ТекущийОбъект)` (для форм документов/справочников) и `ПриОткрытии(Отказ)` добавляются вызовы обновления команд (`ПодключаемыеКомандыКлиентСервер.ОбновитьКоманды(...)`, `ПодключаемыеКомандыКлиент.НачатьОбновлениеКоманд(...)`).
- Рекомендуется при изменении «ключевых» реквизитов объекта, от которых зависят условия видимости/доступности команд, вызывать методы обновления команд (`ПодключаемыеКомандыКлиент.НачатьОбновлениеКоманд` или `ПодключаемыеКомандыКлиентСервер.ОбновитьКоманды`).

----

### 1.2. Типовая задача: «Настроить права доступа пользователей для работы с подключаемыми командами»

**Краткое описание**  
Для большинства операций достаточно, чтобы пользователь имел базовые права (например, `БазовыеПраваБСП` из БСП). Дополнительных действий по настройке прав доступа в большинстве случаев не требуется.

----

## 2. Использование при разработке конфигурации

### 2.1. Типовая задача: «Подключить свои отчёты и обработки к механизмам конфигурации (Печать, Отчёты и т.д.)»

**Краткое описание**  
Если у вас есть отчёт или обработка, которую нужно вывести в подменю «Печать», «Заполнить» или «Отчёты» (либо настроить варианты отчётов), то необходимо:
1. Включить отчёт/обработку в подсистему `ПодключаемыеОтчетыИОбработки`.
2. В модуле менеджера объекта (отчёта/обработки) определить процедуру `ПриОпределенииНастроек(Настройки)`, где указать необходимые флаги: `ДобавитьКомандыПечати`, `ДобавитьКомандыЗаполнения`, `ДобавитьКомандыОтчетов`, `НастроитьВариантыОтчета` и т.д.
3. По этим флагам в модуле менеджера объекта реализовать соответствующие процедуры:
   - `ДобавитьКомандыПечати(КомандыПечати)`
   - `ДобавитьКомандыЗаполнения(КомандыЗаполнения, Параметры)`
   - `ДобавитьКомандыОтчетов(КомандыОтчетов, Параметры)`
   - `НастроитьВариантыОтчета(Настройки, НастройкиОтчета)` (если есть необходимость тонко переопределять логику формы отчёта в «Вариантах отчётов»)

Ниже — общий пример структуры:

```bsl
// Модуль менеджера обработки или отчета

#Область ПрограммныйИнтерфейс
////////////////////////////////////////////////////////////////////////////////
// Процедура настройки интеграции этого объекта

Процедура ПриОпределенииНастроек(Настройки) Экспорт
    // Перечисляем объекты конфигурации, к которым подключается обработка/отчет
    Настройки.Размещение.Добавить(Метаданные.Документы.МойДокумент);
    // Указываем, какие именно команды добавляем
    Настройки.ДобавитьКомандыПечати      = Истина;
    Настройки.ДобавитьКомандыЗаполнения  = Истина;
    Настройки.ДобавитьКомандыОтчетов     = Истина;
    Настройки.НастроитьВариантыОтчета    = Истина;
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Пример процедуры, добавляющей команды печати

Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
    // Здесь можно добавить команды печати (например, PDF, Excel, что угодно).
    // КомандыПечати — ТаблицаЗначений, где каждая строка описывает одну команду.
    // ...
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Пример процедуры, добавляющей команды заполнения

Процедура ДобавитьКомандыЗаполнения(КомандыЗаполнения, Параметры) Экспорт
    // Здесь можно добавить свои команды для заполнения документов/справочников.
    // ...
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Пример процедуры, добавляющей команды отчетов

Процедура ДобавитьКомандыОтчетов(КомандыОтчетов, Параметры) Экспорт
    // Здесь можно добавить команды, которые будут выводиться в подменю «Отчеты».
    // ...
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Пример настройки вариантов отчета

Процедура НастроитьВариантыОтчета(Настройки, НастройкиОтчета) Экспорт
    // При необходимости донастроить размещение и свойства варианта отчета
    // ...
КонецПроцедуры

#КонецОбласти
```

----

### 2.2. Типовая задача: «Разработка и подключение команд создания на основании»

**Краткое описание**  
Команды создания на основании нужны, чтобы быстро вводить новые объекты (документы/справочники), предзаполнив их данными из существующего объекта-основания. Эти команды автоматически группируются в подменю «Создать на основании».

#### Основные этапы

1. **Перечислить объекты**, у которых должны быть команды «Создать на основании», в процедуре:
   ```bsl
   // Общий модуль СозданиеНаОснованииПереопределяемый
   Процедура ПриОпределенииОбъектовСКомандамиСозданияНаОсновании(Объекты) Экспорт
       Объекты.Добавить(Метаданные.Документы.МойДокумент1);
       Объекты.Добавить(Метаданные.Документы.МойДокумент2);
       // ...
   КонецПроцедуры
   ```

2. **В модуле менеджера каждого объекта**, который может становиться «основанием», создать:
   - Функцию `ДобавитьКомандуСоздатьНаОсновании(КомандыСозданияНаОсновании)`  
     Добавляет команду для **создания** именно этого типа объекта.
   - Процедуру `ДобавитьКомандыСозданияНаОсновании(КомандыСозданияНаОсновании, Параметры)`  
     Перечисляет все объекты, которые могут быть созданы **из этого объекта-основания**.

**Пример кода** (для документа `_ДемоСчетНаОплатуПокупателю`, который может быть основанием):

```bsl
Функция ДобавитьКомандуСоздатьНаОсновании(КомандыСозданияНаОсновании) Экспорт
    // Добавим создание документа "_ДемоСписаниеТоваров"
    Возврат СозданиеНаОсновании.ДобавитьКомандуСозданияНаОсновании(
        КомандыСозданияНаОсновании,
        Метаданные.Документы._ДемоСписаниеТоваров
    );
КонецФункции

Процедура ДобавитьКомандыСозданияНаОсновании(
    КомандыСозданияНаОсновании, Параметры) Экспорт

    // Включим в подменю «Создать на основании» сразу несколько документов
    Документы._ДемоСписаниеТоваров.ДобавитьКомандуСоздатьНаОсновании(
        КомандыСозданияНаОсновании
    );
    Документы._ДемоПеремещениеТоваров.ДобавитьКомандуСоздатьНаОсновании(
        КомандыСозданияНаОсновании
    );
    // ...
КонецПроцедуры
```

> **Основные параметры команд создания на основании**  
> - `Представление` (строка) — заголовок команды.  
> - `Идентификатор` (строка) — код команды.  
> - `Важность` (строка) — «Важное», «Обычное» или «СмТакже» (группировка в подменю).  
> - `Порядок` (число) — от 1 до 100, влияет на сортировку команд. По умолчанию 50.  
> - `СочетаниеКлавиш` — если нужно назначить горячую клавишу.  
> - `ТипПараметра`, `ВидимостьВФормах`, `ФункциональныеОпции`, `УсловияВидимости` — управляют тем, при каких условиях команда отображается/скрывается.  
> - `МножественныйВыбор` (булево) — если нужно поддерживать одновременное создание на основании нескольких выделенных ссылок.  
> - `РежимЗаписи` (строка) — «Записывать» или «Проводить» перед выполнением команды.

----

### 2.3. Типовая задача: «Разработка и подключение команд заполнения объектов»

**Краткое описание**  
Команды заполнения объектов используются для автоматического заполнения полей или табличных частей. Список команд группируется в подменю «Заполнить». Это может быть полезно, например, чтобы загрузить данные в документ из внешнего источника или заполнить реквизиты по шаблону.

#### Основные этапы

1. **Перечислить объекты**, которым нужны команды заполнения, в процедуре:
   ```bsl
   // Общий модуль ЗаполнениеОбъектовПереопределяемый
   Процедура ПриОпределенииОбъектовСКомандамиЗаполнения(Объекты) Экспорт
       Объекты.Добавить(Метаданные.Документы.МойДокумент);
       // ...
   КонецПроцедуры
   ```

2. **В модуле менеджера** каждого объекта, перечисленного выше, создать процедуру `ДобавитьКомандыЗаполнения(КомандыЗаполнения, Параметры)`.

3. Если команды заполнения должны быть **универсальными** для многих объектов, их можно описать:
   - в общем модуле `ЗаполнениеОбъектовПереопределяемый` в процедуре `ПередДобавлениемКомандЗаполнения(...)`,  
   - либо в **отдельной обработке**, включённой в подсистему `ПодключаемыеОтчетыИОбработки`.

**Пример кода** (процедура в модуле менеджера документа «МойДокумент»):

```bsl
Процедура ДобавитьКомандыЗаполнения(КомандыЗаполнения, Параметры) Экспорт
    
    // 1) простая команда «ЗагрузитьИзCSV»
    Команда = КомандыЗаполнения.Добавить();
    Команда.Представление = "Загрузить из CSV";
    Команда.Обработчик    = "ЗаполнитьИзCSV";

    // 2) вторая команда «ПредзаполнитьШаблонТТН»
    Команда = КомандыЗаполнения.Добавить();
    Команда.Представление = "Заполнить ТТН";
    Команда.Обработчик    = "ЗаполнитьТТН";
    Команда.РежимЗаписи   = "НеЗаписывать"; // не будем записывать перед выполнением

    // Дополнительные настройки:
    // Команда.ВидимостьВФормах         = "ФормаДокумента";
    // Команда.МножественныйВыбор       = Ложь;
    // Команда.ИзменяетВыбранныеОбъекты = Истина;

КонецПроцедуры
```

**Обработчик команды** может находиться:
- В модуле менеджера (серверная процедура) с сигнатурой:
  ```bsl
  Процедура <ИмяОбработчика>(СсылкаДокумента, ПараметрыВыполнения) Экспорт
      // ...
  КонецПроцедуры
  ```
- В модуле формы (клиентская процедура) с сигнатурой:
  ```bsl
  &НаКлиенте
  Процедура <ИмяОбработчика>(СсылкаДокумента, ПараметрыВыполнения) Экспорт
      // ...
  КонецПроцедуры
  ```
  если указано `Команда.ИмяФормы = "..."`.

**Основные параметры команды заполнения** аналогичны параметрам команд создания на основании:
- `Представление`, `Идентификатор`, `Важность`, `Порядок`, `СочетаниеКлавиш`;
- `ТипПараметра`, `ВидимостьВФормах`, `ФункциональныеОпции`, `УсловияВидимости`, `ИзменяетВыбранныеОбъекты`;
- `МножественныйВыбор`, `РежимЗаписи` (включает режим «НеЗаписывать», «Записывать», «Проводить» и т.д.), `ТребуетсяРаботаСФайлами`.

----

### 2.4. Типовая задача: «Расширить виды подключаемых команд (помимо стандартных «Печать», «Отчёты», «Заполнить», «Создать на основании»)»

**Краткое описание**  
В БСП есть механизм добавления **своих** видов подключаемых команд. Например, если нужно вывести подменю «Мотиваторы» или «Бизнес-процессы» — вы можете добавить новый вид и автоматически формировать команды в этом подменю.

#### Основные шаги

1. В **модуле `ПодключаемыеКомандыПереопределяемый`** переопределить процедуру:
   ```bsl
   Процедура ПриОпределенииВидовПодключаемыхКоманд(ВидыПодключаемыхКоманд) Экспорт
       Вид = ВидыПодключаемыхКоманд.Добавить();
       Вид.Имя        = "Мотиваторы";
       Вид.ИмяПодменю = "ПодменюМотиваторов";
       Вид.Заголовок  = НСтр("ru='Мотиваторы'");
   КонецПроцедуры
   ```
2. Добавить в процедуру `ПриОпределенииСоставаНастроекПодключаемыхОбъектов(...)` **новый ключ**, например `ДобавитьМотиваторы` (Булево).
3. В процедуре `ПриОпределенииКомандПодключенныхКОбъекту(...)` добавить логику, которая собирает команды данного вида, если `ДобавитьМотиваторы = Истина`.
4. Реализовать сами команды (так же, как команды заполнения или создания на основании).

----

### 2.5. Типовая задача: «Настройка обмена данными с использованием подключаемых команд»

**Краткое описание**  
Подсистема «Подключаемые команды» не хранит собственных данных, поэтому **дополнительной настройки обмена** (в плане регистров или другой метаданных) не требует.

----

## Приложение: Таблицы параметров команд

Ниже приведены основные поля (параметры) команд, упоминаемые в тексте. В рамках RAG или просто при разработке удобно иметь под рукой таблицу, где описано, за что отвечает каждый параметр.

### Таблица параметров команд «Создание на основании»

| Параметр                     | Тип                                       | Назначение                                                                                                                                                |
|-----------------------------|-------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Представление**           | Строка                                    | Текст команды (отображаемый в форме)                                                                                                                     |
| **Идентификатор**           | Строка                                    | Код команды (если не задан, формируется автоматически)                                                                                                    |
| **Важность**                | Строка                                    | Группа, к которой относится команда: `Важное`, `Обычное`, `СмТакже`                                                                                       |
| **Порядок**                 | Число (1–100)                             | Сортировка команд внутри группы. По умолчанию `50`.                                                                                                       |
| **СочетаниеКлавиш**         | СочетаниеКлавиш                           | Горячая клавиша для вызова команды                                                                                                                        |
| **ТипПараметра**            | ОписаниеТипов                             | Типы объектов, для которых предназначена команда                                                                                                          |
| **ВидимостьВФормах**        | Строка                                    | Список форм, через запятую, где команда будет отображаться. По умолчанию — во всех.                                                                       |
| **ФункциональныеОпции**     | Строка                                    | Какие функциональные опции должны быть включены, чтобы команда была видна                                                                                 |
| **УсловияВидимости**        | Массив                                    | Условные выражения (объединяются по «И»). Используется процедура `ПодключаемыеКоманды.ДобавитьУсловиеВидимостиКоманды()`                                  |
| **МножественныйВыбор**      | Булево                                    | `Истина` = можно создать на основании сразу несколько документов. В обработчик приходит массив ссылок                                                     |
| **РежимЗаписи**             | Строка (`Записывать`, `Проводить`)        | Перед выполнением команды будет ли объект (документ) записан/проведён                                                                                    |

### Таблица параметров команд «Заполнение объектов»

| Параметр                     | Тип                                                 | Назначение                                                                                                                                                                                         |
|-----------------------------|-----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Представление**           | Строка                                              | Текст команды (отображаемый в форме)                                                                                                                                                               |
| **Идентификатор**           | Строка                                              | Код команды (если не задан, формируется автоматически)                                                                                                                                              |
| **Важность**                | Строка                                              | Группа, к которой относится команда: `Важное`, `Обычное`, `СмТакже`                                                                                                                                 |
| **Порядок**                 | Число (1–100)                                       | Сортировка команд внутри группы. По умолчанию `50`.                                                                                                                                                 |
| **СочетаниеКлавиш**         | СочетаниеКлавиш                                     | Горячая клавиша для вызова команды                                                                                                                                                                  |
| **Менеджер**                | Строка (полное имя объекта метаданных)              | Автоматически задаётся, если команда объявлена в модуле менеджера; указывает, в каком модуле искать обработчик                                                                                      |
| **Обработчик**              | Строка (имя процедуры)                              | Основная процедура обработки команды (в модуле менеджера или общего модуля). Если **не** указано, но заполнено `ИмяФормы`, то после открытия формы обработка команды может быть осуществлена средствами формы.                            |
| **ИмяФормы**                | Строка (имя формы)                                  | Если указано, система будет получать и открывать соответствующую форму, а если указан ещё и `Обработчик` — вызовет процедуру формы (клиентскую).                                                  |
| **ПараметрыФормы**          | Структура, Неопределено                             | Параметры, с которыми нужно открыть форму (если `ИмяФормы` заполнено).                                                                                                                              |
| **ДополнительныеПараметры** | Структура, Неопределено                             | Любая структура, которая понадобится обработчику команды (например, для передачи специфических флагов или настроек).                                                                               |
| **ТипПараметра**            | ОписаниеТипов                                       | Типы объектов, для которых предназначена команда (если обработка общая).                                                                                                                            |
| **ВидимостьВФормах**        | Строка                                              | Список форм, через запятую, где команда будет отображаться. По умолчанию — во всех.                                                                                                                 |
| **ФункциональныеОпции**     | Строка                                              | Какие функциональные опции должны быть включены, чтобы команда была видна                                                                                                                           |
| **УсловияВидимости**        | Массив                                              | Условные выражения (объединяются по «И»). Используется процедура `ПодключаемыеКоманды.ДобавитьУсловиеВидимостиКоманды()`.                                                                           |
| **ИзменяетВыбранныеОбъекты**| Булево                                              | Если `Истина` = требует право на изменение данных (иначе кнопка будет недоступна).                                                                                                                  |
| **МножественныйВыбор**      | Булево                                              | `Истина` = команда вызывается для массива ссылок, `Ложь` = для одной ссылки.                                                                                                                         |
| **РежимЗаписи**             | Строка (`НеЗаписывать`, `Записывать`, `Проводить`)  | Указывает, нужно ли перед вызовом команды **записывать/проводить** объект. Есть также вариант `ЗаписыватьТолькоНовые`.                                                                              |
| **ТребуетсяРаботаСФайлами** | Булево                                              | Если `Истина`, в веб-клиенте пользователь получит запрос на установку расширения для работы с файлами.                                                                                             |
